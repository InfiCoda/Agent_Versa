# 故障排查指南

## 任务立即失败（状态显示"失败"，样本数0/0）

### 问题现象
- 任务启动后立即显示"失败"状态
- 样本数显示为 0/0
- 无法查看结果

### 常见原因及解决方案

#### 1. 数据集路径为空或错误

**症状**：任务立即失败，错误信息可能包含"JSON数据源需要提供file_path"或"文件不存在"

**解决方案**：
1. **检查数据集路径**：
   - 如果使用相对路径：`app/data/samples.json`（相对于项目根目录）
   - 如果使用绝对路径：`C:\Users\YourName\data\samples.json`
   
2. **使用示例数据集**（推荐）：
   - 路径填写：`app/data/samples.json`
   - 这是系统内置的示例数据集，包含5个测试样本

3. **检查文件是否存在**：
   - 打开文件管理器，确认文件路径正确
   - 确保文件格式为JSON，且格式正确

#### 2. API端点配置错误

**症状**：错误信息可能包含"API调用失败"或"API错误"

**解决方案**：

**DeepSeek API配置**：
- API端点：`https://api.deepseek.com/v1/chat/completions`
- API密钥：你的DeepSeek API密钥
- 确保API密钥有效且有足够余额

**其他API配置**：
- 检查API端点URL是否正确
- 检查API密钥是否正确
- 检查API服务是否可访问（网络连接、防火墙等）

#### 3. 未选择评估指标

**症状**：错误信息可能包含"未选择任何评估指标"

**解决方案**：
- 在创建任务时，至少选择一个评估指标
- 推荐选择：BLEU分数、ROUGE-L分数、准确率

#### 4. 数据集格式错误

**症状**：错误信息可能包含"JSON文件格式不正确"

**解决方案**：
- 确保数据集是有效的JSON格式
- 每个样本必须包含 `input` 字段
- 建议包含 `expected_output` 和 `reference` 字段

正确的格式：
```json
[
    {
        "input": "问题",
        "expected_output": "期望答案",
        "reference": ["参考答案1", "参考答案2"]
    }
]
```

## 如何查看详细错误信息

### 方法1：查看任务描述
1. 在任务列表中，找到失败的任务
2. 查看任务描述字段，如果任务失败，系统会自动将错误信息保存到描述中

### 方法2：查看后端日志
1. 打开运行后端服务的命令行窗口
2. 查看控制台输出的错误信息
3. 错误信息会显示具体的失败原因

### 方法3：查看任务详情
1. 点击失败任务的"查看详情"按钮
2. 系统会显示错误信息（如果已保存）

## DeepSeek API 配置说明

### 正确的配置方式

1. **API端点**：
   ```
   https://api.deepseek.com/v1/chat/completions
   ```

2. **API密钥**：
   - 从DeepSeek官网获取：https://platform.deepseek.com
   - 确保密钥有效且有余额

3. **数据集路径**（必填）：
   - 示例：`app/data/samples.json`
   - 或使用你的自定义数据集路径

### DeepSeek API 请求格式

系统会自动适配DeepSeek API格式：
- 使用 `messages` 格式（OpenAI兼容）
- 默认模型：`deepseek-chat`
- 自动解析响应格式

## 快速测试步骤

如果遇到问题，按以下步骤逐一检查：

1. **测试数据集加载**：
   - 使用内置数据集：`app/data/samples.json`
   - 确保路径正确

2. **测试API连接**：
   - 先使用内置模拟响应（API端点留空）
   - 如果模拟响应正常工作，说明数据集和系统功能正常
   - 再测试真实API

3. **检查指标选择**：
   - 至少选择一个评估指标
   - 推荐：BLEU、ROUGE-L、准确率

4. **查看错误信息**：
   - 查看任务描述
   - 查看后端日志
   - 根据错误信息针对性解决

## 常见错误信息对照

| 错误信息 | 原因 | 解决方案 |
|---------|------|---------|
| `JSON数据源需要提供file_path` | 数据集路径为空 | 填写数据集路径 |
| `文件不存在: xxx` | 数据集文件路径错误 | 检查路径是否正确 |
| `未选择任何评估指标` | 没有选择指标 | 至少选择一个指标 |
| `API调用失败` | API连接问题 | 检查API端点和网络 |
| `API错误 401` | API密钥无效 | 检查API密钥 |
| `API错误 429` | API调用频率限制 | 等待后重试 |
| `API错误 500` | API服务端错误 | 稍后重试或联系API提供商 |

## 获取帮助

如果以上方法都无法解决问题：

1. **检查后端日志**：查看详细的错误堆栈信息
2. **检查网络连接**：确保可以访问API端点
3. **验证API密钥**：在DeepSeek官网验证密钥是否有效
4. **检查数据集格式**：确保JSON格式正确

## 测试建议

建议按以下顺序测试：

1. **第一步**：使用内置模拟响应（API端点留空）+ 示例数据集
   - 验证系统基本功能是否正常

2. **第二步**：使用本地模拟API + 示例数据集
   - 验证API调用流程是否正常

3. **第三步**：使用真实DeepSeek API + 示例数据集
   - 验证真实API调用是否正常

4. **第四步**：使用真实API + 自定义数据集
   - 进行实际评估

这样可以逐步定位问题所在。

